-- CONSULTAS GLOBALES PARA UNIR TODAS LAS TABLAS Y VALORES CALCULADOS -- CREACI흁 DE LAS TABLAS INTERMEDIAS
CREATE TABLE ALL_RECH_PS AS
SELECT RECH1.ANO, RECH1.ID1, RECH1.HHID, RECH1.HVIDX, HV102, HV103, HV104, HV105, HV109, HV112, HV114, HV117, HV120, QH25A, QH25B, 
SH11A, SH11B, SH11C, SH11D, SH11E, SH11Y, SH11Z,
HC1, HC2, HC3, HC27, HC51, HC53, HC55, HC56, HC57, HC60, HC61, HC62, HC63, HC64, HC68, RECH6.HV005A as HV005A_RECH6,RECH0.HV005A as HV005A_RECH0, HV005X,
HV000, RECH0.HV001, RECH0.HV002, RECH0.HV002A, HV003, HV009, HV010, HV015, HV023, HV024, HV025, HV026, HV042, HV022, HV005,
HV201, HV202, HV204, HV205, HV206, HV219,  HV237, HV237A, HV237B, HV237C, HV237D, HV237E, HV237F, HV237G, HV237H, HV237I, HV237J, HV237K, HV237X, HV237Z, SHREGION, SHSEMES, SHPROVIN, SHDISTRI, HV270, HV271,
PS107_1A, PS107_1M, PS107_1S, PS6,
CONCAT(RECH1.HHID, RIGHT(CONCAT("  ",RECH6.HC51),3)) as ID_Responsable,
CONCAT(RECH1.HHID, RIGHT(CONCAT("  ",RECH6.HC60),3)) as ID_Madre,
CONCAT(CONCAT(RECH1.HHID, RIGHT(CONCAT("  ",RECH6.HC60),3))," ",RECH6.HC64) as RECH_ID_Ni絪_nac
FROM RECH1
LEFT JOIN RECH4 ON RECH1.ANO = RECH4.ANO AND RECH1.HHID = RECH4.HHID AND RECH1.HVIDX = RECH4.IDXH4
JOIN RECH6 ON RECH1.ANO = RECH6.ANO AND RECH1.HHID = RECH6.HHID AND RECH1.HVIDX = RECH6.HC0
LEFT JOIN RECH0 ON RECH1.ANO = RECH0.ANO AND RECH1.HHID = RECH0.HHID
LEFT JOIN RECH23 ON RECH1.ANO = RECH23.ANO AND RECH1.HHID = RECH23.HHID
LEFT JOIN PS_WAWAWASI ON RECH1.ANO = PS_WAWAWASI.ANO AND RECH1.HHID = PS_WAWAWASI.HHID AND RECH1.HVIDX = PS_WAWAWASI.HVIDX AND RECH0.HV001 = PS_WAWAWASI.QHCLUSTER AND RECH0.HV002 = PS_WAWAWASI.QHNUMBER AND RECH0.HV002A = PS_WAWAWASI.QHHOME
;
CREATE INDEX IND_ANO ON ALL_RECH_PS(ANO);
CREATE INDEX IND_HHID ON ALL_RECH_PS(HHID);
CREATE INDEX IND_ID_Ni絪_nac ON ALL_RECH_PS(RECH_ID_Ni絪_nac);

CREATE TABLE ALL_REC AS
SELECT REC43.ANO, REC43.ID1, REC43.CASEID, HIDX, H11, H22, H31, H34, H41B, H42,
S45NM1, S45NM2, S45NM3, S45RT1, S45RT2, S45VA3, S466, S466C, S476AS7, S476AT7, S476AR7, S465EA, S465EB, S465EC, S465ED, S465DB_A, S465DB_B, S465DB_C, 
S465DB_D, S465DD_AR, S465DD_AC, S465DD_BR, S465DD_BC, S465DD_CR, S465DD_CC, S465DD_DR, S465DD_DC, Q452, Q465DF, Q465DH, Q465DJ, Q465EB_A8, Q465EC_A9,
S425A, S432, S436C, QI422A_A, QI422A_B, QI422A_C, QI422A_D, QI440B,
M4, M5, M14, M18, M19, M19A, M34, M35, M36, M42E, M45, M46, M54, M70, M73,
BORD, B0, B4, B5, B8, Q220A, QULT5,
CONCAT(REC43.CASEID," ",REC21.BORD) AS REC_ID_Ni絪_nac
FROM REC43
CROSS JOIN REC95 ON REC43.ANO = REC95.ANO AND REC43.CASEID = REC95.CASEID AND REC43.HIDX = REC95.IDX95
CROSS JOIN REC94 ON REC43.ANO = REC94.ANO AND REC43.CASEID = REC94.CASEID AND REC43.HIDX = REC94.IDX94
CROSS JOIN REC41 ON REC43.ANO = REC41.ANO AND REC43.CASEID = REC41.CASEID AND REC43.HIDX = REC41.MIDX
CROSS JOIN REC21 ON REC43.ANO = REC21.ANO AND REC43.CASEID = REC21.CASEID AND REC43.HIDX = REC21.BIDX
;
CREATE INDEX IND_ANO ON ALL_REC(ANO);
CREATE INDEX IND_CASEID ON ALL_REC(CASEID);
CREATE INDEX IND_ID_Ni絪_nac ON ALL_REC(REC_ID_Ni絪_nac);

CREATE TABLE ALL_PADRES AS
SELECT REC0111.ANO, REC0111.ID1, REC0111.HHID, REC0111.CASEID, REC0111.V001, REC0111.V002, REC0111.V003, REC0111.V012, REC0111.V023, 
       REC0111.V024, REC0111.V025, REC0111.V040, REC0111.V042, REC0111.V102, REC0111.V106, REC0111.V113, V116, V119, V136, AWFACTT, 
       AWFACTU, AWFACTR, AWFACTE, AWFACTW, V155, UBIGEO, REC0111.V022, REC0111.V005, V190, V191, MUJERES12A,
       V201, V202, V208
FROM REC0111
LEFT JOIN RE223132 ON REC0111.ANO = RE223132.ANO AND REC0111.CASEID = RE223132.CASEID 
;
CREATE INDEX IND_ANO ON ALL_PADRES(ANO);
CREATE INDEX IND_HHID ON ALL_PADRES(HHID);
CREATE INDEX IND_CASEID ON ALL_PADRES(CASEID);


-- UNIR TODO
CREATE TABLE ALL_DATA AS
SELECT 
	ALL_RECH_PS.ANO, ALL_RECH_PS.ID1, ALL_RECH_PS.HHID, ALL_RECH_PS.HVIDX, HV102, HV103, HV104, HV105, HV109, HV112, HV114, HV117, HV120, QH25A, QH25B, SH11A, SH11B, SH11C, SH11D, SH11E, SH11Y, SH11Z,
	HC1, HC2, HC3, HC27, HC51, HC53, HC55, HC56, HC57, HC60, HC61, HC62, HC63, HC64, HC68,HV005A_RECH6, HV005A_RECH0, HV005X, HV000, ALL_RECH_PS.HV001, ALL_RECH_PS.HV002, ALL_RECH_PS.HV002A, HV003, HV009, HV010, HV015, HV023, 
	HV024, HV025, HV026, HV042, HV022, HV005, HV201, HV202, HV204, HV205, HV206, HV219, HV237, HV237A, HV237B, HV237C, HV237D, HV237E, HV237F, HV237G, HV237H, HV237I, HV237J, HV237K, HV237X, HV237Z, SHREGION, SHSEMES, SHPROVIN, 
	SHDISTRI, HV270, HV271,PS107_1A, PS107_1M, PS107_1S, PS6, ID_Responsable, ID_Madre, RECH_ID_Ni침o_nac, ALL_REC.CASEID, HIDX, H11, H22, H31, H34, H41B, H42, S45NM1, S45NM2, S45NM3, S45RT1, S45RT2, S45VA3, S466, S466C, 
	S476AS7, S476AT7, S476AR7, S465EA, S465EB, S465EC, S465ED, S465DB_A, S465DB_B, S465DB_C, S465DB_D, S465DD_AR, S465DD_AC, S465DD_BR, S465DD_BC, S465DD_CR, S465DD_CC, S465DD_DR, S465DD_DC, Q452, Q465DF, Q465DH, Q465DJ, 
	Q465EB_A8, Q465EC_A9, S425A, S432, S436C, QI422A_A, QI422A_B, QI422A_C, QI422A_D, QI440B, M4, M5, M14, M18, M19, M19A, M34, M35, M36, M42E, M45, M46, M54, M70, M73, BORD, B0, B4, B5, B8, Q220A, QULT5, V001, V002, V003, V012,
	V023, V024, V025, V040, V042, V102, V106, V113, V116, V119, V136, AWFACTT, AWFACTU, AWFACTR, AWFACTE, AWFACTW, V155, UBIGEO, V022, V005, V190, V191, MUJERES12A, V201, V202, V208
FROM ALL_RECH_PS
LEFT JOIN ALL_REC ON ALL_RECH_PS.ANO = ALL_REC.ANO AND ALL_RECH_PS.RECH_ID_Ni침o_nac = ALL_REC.REC_ID_Ni침o_nac
LEFT JOIN ALL_PADRES ON ALL_RECH_PS.ANO = ALL_PADRES.ANO AND ALL_RECH_PS.ID_Responsable = ALL_PADRES.CASEID
;
CREATE INDEX IND_ANO ON ALL_DATA(ANO);
CREATE INDEX IND_HHID ON ALL_DATA(HHID);
CREATE INDEX IND_HVIDX ON ALL_DATA(HVIDX);
CREATE INDEX IND_ID_Ni침o_nac ON ALL_DATA(RECH_ID_Ni침o_nac);
CREATE INDEX IND_CASEID ON ALL_DATA(CASEID);
CREATE INDEX IND_ID_Responsable ON ALL_DATA(ID_Responsable);

-- PARA CREAR LA TABLA 칈NDICE DE ANEMIA

CREATE TABLE data_indiceanemia AS
SELECT * FROM ALL_DATA where HV103 = 1 and HC53 is not null and HC57 <=4
;
CREATE INDEX IND_ANO ON data_indiceanemia(ANO);
CREATE INDEX IND_HHID ON data_indiceanemia(HHID);
CREATE INDEX IND_CASEID ON data_indiceanemia(CASEID);
CREATE INDEX IND_ID_Ni침o_nac ON data_indiceanemia(RECH_ID_Ni침o_nac);
CREATE INDEX IND_ID_Responsable ON data_indiceanemia(ID_Responsable);

CREATE INDEX IND_hv024 ON data_indiceanemia(HV024);
CREATE INDEX IND_shprov ON data_indiceanemia(SHPROVIN);
CREATE INDEX IND_shdistri ON data_indiceanemia(SHDISTRI);


